"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[293],{293:function(n,e,r){r.r(e),r.d(e,{default:function(){return Se}});var t,i,a=r(7186),o=r(9284),d=r(6871),u=r(8321),s=r(4136),c=r(7309),l=r(5728),f=r(6571),x=r(5850),h=r(1910),m=r(2126),p=r(1333),j=r(3020),v=r(286),Z=r(1933),g=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["users",n],(function(){return e("users",{data:n})}))},k=r(184),b=function(){var n=g(),e=n.data,r=n.refetch,t=(0,k.jsxs)(I,{children:[(0,k.jsx)(h.Z.Text,{type:"secondary",children:"\u7ec4\u5458\u5217\u8868"}),(0,k.jsx)(m.ZP,{dataSource:e,renderItem:function(n){return(0,k.jsx)(m.ZP.Item,{children:(0,k.jsx)(m.ZP.Item.Meta,{title:n.name})},n.id)}}),(0,k.jsx)(p.Z,{})]});return(0,k.jsx)(j.Z,{content:t,placement:"bottom",onVisibleChange:function(){return r()},children:(0,k.jsx)("span",{children:"\u7ec4\u5458"})})},I=o.ZP.div(t||(t=(0,a.Z)(["\n  min-width: 30rem;\n"]))),y=r(9042),C=r(6515),P=r(3430),w=r(2791),T=r(5531),O=r(3032),E=r(4322),M=r.n(E),N=function(n){var e=n.fromId,r=n.type,t=n.referenceId,i=n.list,a=(0,T.Z)(i),o=a.findIndex((function(n){return n.id===e}));if(!t)return D((0,T.Z)(a),o,a.length-1);var d=a.findIndex((function(n){return n.id===t}));return("after"===r?D:L)((0,T.Z)(a),o,d)},L=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],a=n.indexOf(t);return n.splice(a,0,i),n},D=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],a=n.indexOf(t);return n.splice(a+1,0,i),n},S=function(n,e){var r=(0,Z.useQueryClient)();return{onSuccess:function(){return r.invalidateQueries(n)},onMutate:function(t){return(0,O.Z)(M().mark((function i(){var a;return M().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=r.getQueryData(n),r.setQueryData(n,(function(n){return e(t,n)})),i.abrupt("return",{previousItems:a});case 3:case"end":return i.stop()}}),i)})))()},onError:function(e,t,i){r.setQueryData(n,i.previousItems)}}},F=function(n){return S(n,(function(n,e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==n.id})))||[]}))},A=function(n){return S(n,(function(n,e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id===n.id?(0,C.Z)((0,C.Z)({},e),n):e})))||[]}))},z=function(n){return S(n,(function(n,e){return e?[].concat((0,T.Z)(e),[n]):[]}))},Y=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["project",(0,x.sW)(n)],(function(){return e("projects",{data:n})}))},Q=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["project",{id:n}],(function(){return e("projects/".concat(n))}),{enabled:Boolean(n)})},R=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("projects/".concat(n.id),{method:"PATCH",data:n})}),A(n))},W=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("projects",{data:n,method:"POST"})}),z(n))},X=r(3504),B=function(n){var e=(0,X.lr)(),r=(0,P.Z)(e,1)[0],t=V(),i=(0,w.useState)(n),a=(0,P.Z)(i,1)[0];return[(0,w.useMemo)((function(){return(0,x.P9)(Object.fromEntries(r),a)}),[r,a]),function(n){return t(n)}]},V=function(){var n=(0,X.lr)(),e=(0,P.Z)(n,2),r=e[0],t=e[1];return function(n){var e=(0,x.sW)((0,C.Z)((0,C.Z)({},Object.fromEntries(r)),n));return t(e)}},H=function(){var n=B(["projectCreate"]),e=(0,P.Z)(n,2),r=e[0].projectCreate,t=e[1],i=B(["editingProjectId"]),a=(0,P.Z)(i,2),o=a[0].editingProjectId,d=a[1],u=V(),s=Q(Number(o)),c=s.data,l=s.isLoading;return{projectModalOpen:"true"===r||Boolean(o),open:function(){return t({projectCreate:!0})},close:function(){return u({projectCreate:"",editingProjectId:""})},startEdit:function(n){return d({editingProjectId:n})},editingProject:c,isLoading:l}},K=function(){var n=B(["name","personId"]),e=(0,P.Z)(n,2),r=e[0],t=e[1];return[(0,w.useMemo)((function(){return(0,C.Z)((0,C.Z)({},r),{},{personId:Number(r.personId)||void 0})}),[r]),t]},U=function(){var n=K();return["project",(0,P.Z)(n,1)[0]]},q=function(){var n=H().open,e=Y(),r=e.data,t=e.refetch,i=null===r||void 0===r?void 0:r.filter((function(n){return n.pin})),a=(0,k.jsxs)(_,{children:[(0,k.jsx)(h.Z.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),(0,k.jsx)(m.ZP,{dataSource:i,renderItem:function(n){return(0,k.jsx)(m.ZP.Item,{children:(0,k.jsx)(m.ZP.Item.Meta,{title:n.name})},n.id)}}),(0,k.jsx)(p.Z,{}),(0,k.jsx)(l.zL,{type:"link",onClick:n,children:"\u65b0\u5efa\u9879\u76ee"})]});return(0,k.jsx)(j.Z,{onVisibleChange:function(){return t()},placement:"bottom",content:a,children:(0,k.jsx)("span",{children:"\u9879\u76ee"})})},_=o.ZP.div(i||(i=(0,a.Z)(["\n  min-width: 30rem;\n"]))),G=r(4410),J=r(6005),$=r(3738),nn=r(4917),en=["value","onChange","defaultOptionName","options"],rn=function(n){var e=n.value,r=n.onChange,t=n.defaultOptionName,i=n.options,a=(0,$.Z)(n,en);return(0,k.jsxs)(nn.Z,(0,C.Z)((0,C.Z)({value:null!==i&&void 0!==i&&i.length?tn(e):0,onChange:function(n){return null===r||void 0===r?void 0:r(tn(n)||void 0)}},a),{},{children:[t?(0,k.jsx)(nn.Z.Option,{value:0,children:t}):null,null===i||void 0===i?void 0:i.map((function(n){return(0,k.jsx)(nn.Z.Option,{value:n.id,children:n.name},n.id)}))]}))},tn=function(n){return isNaN(Number(n))?0:Number(n)},an=function(n){var e=g().data;return(0,k.jsx)(rn,(0,C.Z)({options:e||[]},n))},on=function(n){n.users;var e=n.param,r=n.setParam;return(0,k.jsxs)(G.Z,{style:{marginBottom:"2rem"},layout:"inline",children:[(0,k.jsx)(G.Z.Item,{children:(0,k.jsx)(J.Z,{placeholder:"\u9879\u76ee\u540d",type:"text",value:e.name,onChange:function(n){return r((0,C.Z)((0,C.Z)({},e),{},{name:n.target.value}))}})}),(0,k.jsx)(G.Z.Item,{children:(0,k.jsx)(an,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:e.personId,onChange:function(n){return r((0,C.Z)((0,C.Z)({},e),{},{personId:n}))}})})]})},dn=r(6029),un=r(6443),sn=r(7892),cn=r.n(sn),ln=r(7561),fn=["checked","onCheckedChange"],xn=function(n){var e=n.checked,r=n.onCheckedChange,t=(0,$.Z)(n,fn);return(0,k.jsx)(ln.Z,(0,C.Z)({count:1,value:e?1:0,onChange:function(n){return null===r||void 0===r?void 0:r(!!n)}},t))},hn=["users"],mn=function(n){var e=n.users,r=(0,$.Z)(n,hn),t=R(U()).mutate;return(0,k.jsx)(dn.Z,(0,C.Z)({pagination:!1,rowKey:"id",columns:[{title:(0,k.jsx)(xn,{checked:!0,disabled:!0}),render:function(n,e){return(0,k.jsx)(xn,{checked:e.pin,onCheckedChange:(r=e.id,function(n){return t({id:r,pin:n})})});var r}},{title:"\u540d\u79f0",sorter:function(n,e){return n.name.localeCompare(e.name)},render:function(n,e){return(0,k.jsx)(X.rU,{to:"projects/".concat(String(e.id)),children:e.name})}},{title:"\u90e8\u95e8",dataIndex:"organization"},{title:"\u8d1f\u8d23\u4eba",render:function(n,r){var t;return(0,k.jsx)("span",{children:(null===(t=e.find((function(n){return n.id===r.personId})))||void 0===t?void 0:t.name)||"\u672a\u77e5"})}},{title:"\u521b\u5efa\u65f6\u95f4",render:function(n,e){return(0,k.jsx)("span",{children:e.created?cn()(e.created).format("YYYY-MM-DD"):"\u65e0"})}},{render:function(n,e){return(0,k.jsx)(pn,{project:e})}}]},r))},pn=function(n){var e,r=n.project,t=H().startEdit,i=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){var r=n.id;return e("projects/".concat(r),{method:"DELETE"})}),F(n))}(U()),a=i.mutate;return(0,k.jsx)(u.Z,{overlay:(0,k.jsxs)(s.Z,{children:[(0,k.jsx)(s.Z.Item,{onClick:(e=r.id,function(){return t(e)}),children:"\u7f16\u8f91"},"edit"),(0,k.jsx)(s.Z.Item,{onClick:function(){return function(n){un.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417?",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){a({id:n})}})}(r.id)},children:"\u5220\u9664"},"delete")]}),children:(0,k.jsx)(l.zL,{type:"link",children:"\u66f4\u591a"})})},jn=["metadata","phases"],vn=[];setInterval((function(){if(vn.length){var n=(0,T.Z)(vn);vn=[],console.log(n)}}),5e3);var Zn,gn=function(n){var e=n.metadata,r=n.phases,t=(0,$.Z)(n,jn);return(0,k.jsx)(w.Profiler,(0,C.Z)({onRender:function(n,t,i,a,o,d,u){r&&!r.includes(t)||vn.push({id:n,phase:t,actualDuration:i,baseDuration:a,startTime:o,commitTime:d,interactions:u,metadata:e})}},t))},kn=function(){(0,x.jr)("\u9879\u76ee\u5217\u8868",!1);var n=K(),e=(0,P.Z)(n,2),r=e[0],t=e[1],i=H().open,a=(0,x.Nr)(r,2e3),o=Y(a),d=o.isLoading,u=o.error,s=o.data,c=g().data;return(0,k.jsx)(gn,{id:"\u9879\u76ee\u5217\u8868",children:(0,k.jsxs)(bn,{children:[(0,k.jsxs)(l.X2,{marginBottom:2,between:!0,children:[(0,k.jsx)("h1",{children:"\u9879\u76ee\u5217\u8868"}),(0,k.jsx)(l.zL,{onClick:i,type:"link",children:"\u65b0\u5efa\u9879\u76ee"})]}),(0,k.jsx)(on,{users:c||[],param:r,setParam:t}),(0,k.jsx)(l.Tv,{error:u}),(0,k.jsx)(mn,{loading:d,users:c||[],dataSource:s||[]})]})})};kn.whyDidYouRender=!1;var bn=o.ZP.div(Zn||(Zn=(0,a.Z)(["\n  padding: 3.2rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n"]))),In=r(541),yn=function(){var n=(0,v.i)();return(0,Z.useQuery)(["taskTypes"],(function(){return n("taskTypes")}))},Cn=function(n){var e=yn().data;return(0,k.jsx)(rn,(0,C.Z)((0,C.Z)({},n),{},{options:e||[]}))},Pn=function(n){var e=(0,v.i)(),r=(0,C.Z)((0,C.Z)({},n),{},{name:(0,x.Nr)(null===n||void 0===n?void 0:n.name)});return(0,Z.useQuery)(["tasks",r],(function(){return e("tasks",{data:r})}))},wn=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("tasks/reorder",{data:n,method:"POST"})}),function(n){return S(n,(function(n,e){return N((0,C.Z)({list:e},n)).map((function(e){return(null===e||void 0===e?void 0:e.id)===n.fromId?(0,C.Z)((0,C.Z)({},e),{},{kanbanId:n.toKanbanId}):e}))}))}(n))},Tn=function(){var n,e=null===(n=(0,d.TH)().pathname.match(/projects\/(\d+)/))||void 0===n?void 0:n[1];return Number(e)},On=function(){var n=B(["name","typeId","processorId","tagId"]),e=(0,P.Z)(n,1)[0],r=Tn();return(0,w.useMemo)((function(){return{projectId:r,typeId:Number(e.typeId)||void 0,processorId:Number(e.processorId)||void 0,tagId:Number(e.tagId)||void 0,name:e.name}}),[e,r])},En=function(){return Q(Tn())},Mn=function(){return{projectId:Tn()}},Nn=function(){return["kanbans",Mn()]},Ln=function(){return["tasks",On()]},Dn=function(){var n=B(["editingTaskId"]),e=(0,P.Z)(n,2),r=e[0].editingTaskId,t=e[1],i=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["task",{id:n}],(function(){return e("tasks/".concat(n))}),{enabled:Boolean(n)})}(Number(r)),a=i.data,o=i.isLoading;return{editingTaskId:r,editingTask:a,startEdit:(0,w.useCallback)((function(n){t({editingTaskId:n})}),[t]),close:(0,w.useCallback)((function(){t({editingTaskId:""})}),[t]),isLoading:o}},Sn=function(){var n=On(),e=V(),r=(0,w.useState)({name:""}),t=(0,P.Z)(r,2),i=t[0],a=t[1],o=(0,x.Nr)(i);(0,w.useEffect)((function(){e(i)}),[o]);return(0,k.jsxs)(l.X2,{marginBottom:4,gap:!0,children:[(0,k.jsx)(J.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:i.name,onChange:function(n){return a({name:n.target.value})}}),(0,k.jsx)(an,{defaultOptionName:"\u7ecf\u529e\u4eba",value:null===n||void 0===n?void 0:n.processorId,onChange:function(n){return e({processorId:n})}}),(0,k.jsx)(Cn,{defaultOptionName:"\u7c7b\u578b",value:n.typeId,onChange:function(n){return e({typeId:n})}}),(0,k.jsx)(c.Z,{onClick:function(){e({name:void 0,processorId:void 0,tagId:void 0,typeId:void 0}),a({name:""})},children:"\u6e05\u9664\u7b5b\u9009\u5668"})]})};var Fn=r.p+"static/media/task.d2c867c896aad606ed5025a1d7aba34c.svg";var An,zn,Yn=r.p+"static/media/bug.88c5271e76db7e10c2087adbcbac7a97.svg",Qn=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["kanbans",n],(function(){return e("kanbans",{data:n})}))},Rn=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("kanbans/reorder",{data:n,method:"POST"})}),function(n){return S(n,(function(n,e){return N((0,C.Z)({list:e},n))}))}(n))},Wn=r(1111),Xn=r(8874),Bn=["children"],Vn=["children"],Hn=function(n){var e=n.children,r=n.type,t=n.direction,i=n.droppableId;return(0,k.jsx)(Xn.bK,{type:r,direction:t,droppableId:i,children:function(n){return w.isValidElement(e)?w.cloneElement(e,(0,C.Z)((0,C.Z)({},n.droppableProps),{},{ref:n.innerRef,provided:n})):(0,k.jsx)("div",{})}})},Kn=w.forwardRef((function(n,e){var r,t=n.children,i=(0,$.Z)(n,Bn);return(0,k.jsxs)("div",(0,C.Z)((0,C.Z)({ref:e},i),{},{children:[t,null===(r=i.provided)||void 0===r?void 0:r.placeholder]}))})),Un=function(n){var e=n.children,r=(0,$.Z)(n,Vn);return(0,k.jsx)(Xn._l,(0,C.Z)((0,C.Z)({},r),{},{children:function(n){return w.isValidElement(e)?w.cloneElement(e,(0,C.Z)((0,C.Z)((0,C.Z)({},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef})):(0,k.jsx)("div",{})}}))},qn=function(n){var e=n.name,r=n.keyword;if(!r)return(0,k.jsx)(k.Fragment,{children:e});var t=e.split(r);return(0,k.jsx)(k.Fragment,{children:t.map((function(n,e){return(0,k.jsxs)("span",{children:[n,e===t.length-1?null:(0,k.jsx)("span",{style:{color:"#257AFD"},children:r})]},e)}))})},_n=function(n){var e=(0,v.i)();return(0,Z.useQuery)(["epics",n],(function(){return e("epics",{data:n})}))},Gn=function(n){var e=_n().data;return(0,k.jsx)(rn,(0,C.Z)({options:e||[]},n))},Jn={labelCol:{span:8},wrapperCol:{span:16}};function $n(){var n=G.Z.useForm(),e=(0,P.Z)(n,1)[0],r=Dn(),t=r.editingTaskId,i=r.editingTask,a=r.close,o=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("tasks/".concat(n.id),{method:"PATCH",data:n})}),A(n))}(Ln()),d=o.mutateAsync,u=o.isLoading,s=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){var r=n.id;return e("tasks/".concat(r),{method:"DELETE"})}),F(n))}(Ln()).mutate,l=function(){var n=(0,O.Z)(M().mark((function n(){return M().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d((0,C.Z)((0,C.Z)({},i),e.getFieldsValue()));case 2:a();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,w.useEffect)((function(){e.setFieldsValue(i)}),[i,e]),(0,k.jsxs)(un.Z,{forceRender:!0,onCancel:function(){a(),e.resetFields()},onOk:l,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:u,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!t,children:[(0,k.jsxs)(G.Z,(0,C.Z)((0,C.Z)({},Jn),{},{initialValues:i,form:e,children:[(0,k.jsx)(G.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:(0,k.jsx)(J.Z,{})}),(0,k.jsx)(G.Z.Item,{label:"\u4efb\u52a1\u7ec4",name:"epicId",children:(0,k.jsx)(Gn,{defaultOptionName:"\u4efb\u52a1\u7ec4"})}),(0,k.jsx)(G.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,k.jsx)(an,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),(0,k.jsx)(G.Z.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,k.jsx)(Cn,{})})]})),(0,k.jsx)("div",{style:{textAlign:"right"},children:(0,k.jsx)(c.Z,{onClick:function(){a(),un.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return s({id:Number(t)})}})},style:{fontSize:"14px"},size:"small",children:"\u5220\u9664"})})]})}function ne(n){var e=n.kanbanId,r=(0,w.useState)(""),t=(0,P.Z)(r,2),i=t[0],a=t[1],o=(0,w.useState)(!1),d=(0,P.Z)(o,2),u=d[0],s=d[1],c=Tn(),l=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("tasks",{data:n,method:"POST"})}),z(n))}(Ln()).mutateAsync,f=function(){var n=(0,O.Z)(M().mark((function n(){return M().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l({name:i,projectId:c,kanbanId:e});case 2:s(!1),a("");case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();(0,w.useEffect)((function(){u||a("")}),[u]);var x=function(){return s((function(n){return!n}))};return u?(0,k.jsx)(Wn.Z,{children:(0,k.jsx)(J.Z,{onBlur:x,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:f,value:i,onChange:function(n){return a(n.target.value)}})}):(0,k.jsx)("div",{onClick:x,children:"+\u521b\u5efa\u4e8b\u52a1"})}var ee,re=["kanban"],te=(0,w.forwardRef)((function(n,e){var r=n.kanban,t=(0,$.Z)(n,re),i=Pn(On()).data,a=null===i||void 0===i?void 0:i.filter((function(n){return n.kanbanId===r.id}));return(0,k.jsxs)(ue,(0,C.Z)((0,C.Z)({},t),{},{ref:e,children:[(0,k.jsxs)(l.X2,{between:!0,children:[(0,k.jsx)("h3",{children:r.name}),(0,k.jsx)(oe,{kanban:r})]}),(0,k.jsxs)(de,{children:[(0,k.jsx)(Hn,{type:"ROW",direction:"vertical",droppableId:String(r.id),children:(0,k.jsx)(Kn,{style:{minHeight:"1rem"},children:null===a||void 0===a?void 0:a.map((function(n,e){return(0,k.jsx)(Un,{index:e,draggableId:"task"+n.id,children:(0,k.jsx)("div",{children:(0,k.jsx)(ie,{task:n},n.id)})},n.id)}))})}),(0,k.jsx)(ne,{kanbanId:r.id})]}),(0,k.jsx)($n,{})]}))})),ie=function(n){var e=n.task,r=Dn().startEdit,t=On().name;return(0,k.jsxs)(Wn.Z,{onClick:function(){return r(e.id)},style:{marginBottom:"0.5rem",cursor:"pointer"},children:[(0,k.jsx)("p",{children:(0,k.jsx)(qn,{keyword:t,name:e.name})}),(0,k.jsx)(ae,{id:e.typeId})]},e.id)},ae=function(n){var e,r=n.id,t=yn().data,i=null===t||void 0===t||null===(e=t.find((function(n){return n.id===r})))||void 0===e?void 0:e.name;return i?(0,k.jsx)("img",{src:"task"===i?Fn:Yn,alt:"task-icon",style:{width:"2rem"}}):null},oe=function(n){var e=n.kanban,r=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){var r=n.id;return e("kanbans/".concat(r),{method:"DELETE"})}),F(n))}(Nn()).mutateAsync,t=(0,k.jsx)(s.Z,{children:(0,k.jsx)(s.Z.Item,{children:(0,k.jsx)(c.Z,{type:"link",onClick:function(){un.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return r({id:e.id})}})},children:"\u5220\u9664"})})});return(0,k.jsx)(u.Z,{overlay:t,children:(0,k.jsx)(c.Z,{type:"link",children:"..."})})},de=o.ZP.div(An||(An=(0,a.Z)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),ue=o.ZP.div(zn||(zn=(0,a.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"])));function se(){var n=(0,w.useState)(""),e=(0,P.Z)(n,2),r=e[0],t=e[1],i=Tn(),a=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("kanbans",{data:n,method:"POST"})}),z(n))}(Nn()).mutateAsync,o=function(){var n=(0,O.Z)(M().mark((function n(){return M().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a({name:r,projectId:i});case 2:t("");case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,k.jsx)(ue,{children:(0,k.jsx)(J.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",value:r,onChange:function(n){return t(n.target.value)},onPressEnter:o})},i)}function ce(){(0,x.jr)("\u770b\u677f\u5217\u8868");var n=En().data,e=Qn(Mn()),r=e.data,t=e.isLoading,i=Pn(On()).isLoading||t,a=me();return(0,k.jsx)(gn,{id:"\u770b\u677f\u9875\u9762",children:(0,k.jsx)(Xn.Z5,{onDragEnd:a,children:(0,k.jsxs)(l.X_,{children:[(0,k.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u770b\u677f"]}),(0,k.jsx)(Sn,{}),i?(0,k.jsx)(In.Z,{size:"large"}):(0,k.jsxs)(pe,{children:[(0,k.jsx)(Hn,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,k.jsx)(Kn,{style:{display:"flex",flexDirection:"row"},children:null===r||void 0===r?void 0:r.map((function(n,e){return(0,k.jsx)(Un,{draggableId:"kanban"+n.id,index:e,children:(0,k.jsx)(te,{kanban:n},n.id)},n.id)}))})}),(0,k.jsx)(se,{})]})]})})})}var le,fe,xe,he,me=function(){var n=Qn(Mn()).data,e=Rn(Nn()).mutate,r=wn(Ln()).mutate,t=Pn(On()).data,i=void 0===t?[]:t;return(0,w.useCallback)((function(t){var a=t.source,o=t.destination,d=t.type;if(o){if("COLUMN"===d){var u=null===n||void 0===n?void 0:n[a.index].id,s=null===n||void 0===n?void 0:n[o.index].id;if(!u||!s||u===s)return;var c=o.index>a.index?"after":"before";e({fromId:u,referenceId:s,type:c})}if("ROW"===d){var l=+a.droppableId,f=+o.droppableId,x=i.filter((function(n){return n.kanbanId===l}))[a.index],h=i.filter((function(n){return n.kanbanId===f}))[o.index];if((null===x||void 0===x?void 0:x.id)===(null===h||void 0===h?void 0:h.id))return;r({fromId:null===x||void 0===x?void 0:x.id,referenceId:null===h||void 0===h?void 0:h.id,fromKanbanId:l,toKanbanId:f,type:l===f&&o.index>a.index?"after":"before"})}}}),[n,e,i,r])},pe=(0,o.ZP)("div")(ee||(ee=(0,a.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"]))),je=r(8894),ve=function(){return{projectId:Tn()}},Ze=function(){return["epics",ve()]},ge=function(n){var e=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){return e("epics",{data:n,method:"POST"})}),z(n))}(Ze()),r=e.mutate,t=e.isLoading,i=e.error,a=G.Z.useForm(),o=(0,P.Z)(a,1)[0],d=Tn(),u=function(){var e=(0,O.Z)(M().mark((function e(t){return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r((0,C.Z)((0,C.Z)({},t),{},{projectId:d}));case 2:n.onClose();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.useEffect)((function(){o.resetFields()}),[o,n.visible]),(0,k.jsx)(je.Z,{visible:n.visible,onClose:n.onClose,forceRender:!0,destroyOnClose:!0,width:"100%",children:(0,k.jsx)(ke,{children:t?(0,k.jsx)(In.Z,{size:"large"}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,k.jsx)(l.Tv,{error:i}),(0,k.jsxs)(G.Z,{form:o,layout:"vertical",style:{width:"30rem"},onFinish:u,children:[(0,k.jsx)(G.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}],children:(0,k.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})}),(0,k.jsx)(G.Z.Item,{style:{textAlign:"right"},children:(0,k.jsx)(c.Z,{loading:t,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},ke=o.ZP.div(le||(le=(0,a.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),be=function(){var n=En().data,e=_n(ve()).data,r=Pn({projectId:null===n||void 0===n?void 0:n.id}).data,t=function(n){var e=(0,v.i)();return(0,Z.useMutation)((function(n){var r=n.id;return e("epics/".concat(r),{method:"DELETE"})}),F(n))}(Ze()).mutate,i=(0,w.useState)(!1),a=(0,P.Z)(i,2),o=a[0],d=a[1];return(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(l.X_,{children:[(0,k.jsxs)(l.X2,{between:!0,children:[(0,k.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u4efb\u52a1\u7ec4"]}),(0,k.jsx)(c.Z,{onClick:function(){return d(!0)},type:"link",children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,k.jsx)(m.ZP,{style:{overflowY:"scroll"},dataSource:e,itemLayout:"vertical",renderItem:function(e){return(0,k.jsxs)(m.ZP.Item,{children:[(0,k.jsx)(m.ZP.Item.Meta,{title:(0,k.jsxs)(l.X2,{between:!0,children:[(0,k.jsx)("span",{children:e.name}),(0,k.jsx)(c.Z,{onClick:function(){return function(n){un.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u9879\u76ee\u7ec4\uff1a".concat(n.name),content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){t({id:n.id})}})}(e)},type:"link",children:"\u5220\u9664"})]}),description:(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",cn()(e.start).format("YYYY-MM-DD")]}),(0,k.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",cn()(e.end).format("YYYY-MM-DD")]})]})}),(0,k.jsx)("div",{children:null===r||void 0===r?void 0:r.filter((function(n){return n.epicId===e.id})).map((function(e){return(0,k.jsx)(X.rU,{style:{display:"block"},to:"/projects/".concat(null===n||void 0===n?void 0:n.id,"/kanban?editingTaskId=").concat(e.id),children:e.name},e.id)}))})]})}}),(0,k.jsx)(ge,{onClose:function(){return d(!1)},visible:o})]})})};function Ie(){var n=function(){var n=(0,d.TH)().pathname.split("/");return["kanban","epic"].includes(n[n.length-1])?n[n.length-1]:"kanban"}();return(0,k.jsxs)(Ee,{children:[(0,k.jsx)(Me,{children:(0,k.jsxs)(s.Z,{mode:"inline",selectedKeys:[n],children:[(0,k.jsx)(s.Z.Item,{children:(0,k.jsx)(X.rU,{to:"kanban",children:"\u770b\u677f"})},"kanban"),(0,k.jsx)(s.Z.Item,{children:(0,k.jsx)(X.rU,{to:"epic",children:"\u4efb\u52a1\u7ec4"})},"epic")]})}),(0,k.jsx)(Ne,{children:(0,k.jsxs)(d.Z5,{children:[(0,k.jsx)(d.AW,{path:"kanban",element:(0,k.jsx)(ce,{})}),(0,k.jsx)(d.AW,{path:"epic",element:(0,k.jsx)(be,{})}),(0,k.jsx)(d.AW,{index:!0,element:(0,k.jsx)(ce,{})})]})})]})}var ye,Ce,Pe,we,Te,Oe,Ee=o.ZP.div(fe||(fe=(0,a.Z)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  width: 100%;\n  height: calc(100vh - 6.4rem);\n"]))),Me=o.ZP.aside(xe||(xe=(0,a.Z)(["\n  background-color: rgb(244, 245, 247);\n  display: flex;\n"]))),Ne=o.ZP.div(he||(he=(0,a.Z)(["\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\n  display: flex;\n  overflow: hidden;\n"]))),Le=function(){var n=H(),e=n.projectModalOpen,r=n.close,t=n.editingProject,i=n.isLoading,a=(t?R:W)(U()),o=a.mutateAsync,d=a.error,u=a.isLoading,s=G.Z.useForm(),f=(0,P.Z)(s,1)[0],x=t?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,w.useEffect)((function(){f.setFieldsValue(t)}),[t,f]),(0,k.jsx)(je.Z,{forceRender:!0,onClose:function(){f.resetFields(),r()},visible:e,width:"100%",children:(0,k.jsx)(De,{children:i?(0,k.jsx)(In.Z,{size:"large"}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("h1",{children:x}),(0,k.jsx)(l.Tv,{error:d}),(0,k.jsxs)(G.Z,{form:f,layout:"vertical",style:{width:"40rem"},onFinish:function(n){o((0,C.Z)((0,C.Z)({},t),n)).then((function(){f.resetFields(),r()}))},children:[(0,k.jsx)(G.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"}],children:(0,k.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"})}),(0,k.jsx)(G.Z.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"}],children:(0,k.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"})}),(0,k.jsx)(G.Z.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId",children:(0,k.jsx)(an,{defaultOptionName:"\u8d1f\u8d23\u4eba"})}),(0,k.jsx)(G.Z.Item,{style:{textAlign:"right"},children:(0,k.jsx)(c.Z,{loading:u,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},De=o.ZP.div(ye||(ye=(0,a.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"])));function Se(){return(0,k.jsxs)(ze,{children:[(0,k.jsx)(Fe,{}),(0,k.jsx)(We,{children:(0,k.jsxs)(d.Z5,{children:[(0,k.jsx)(d.AW,{path:"/projects",element:(0,k.jsx)(kn,{})}),(0,k.jsx)(d.AW,{path:"/projects/:projectId/*",element:(0,k.jsx)(Ie,{})}),(0,k.jsx)(d.AW,{index:!0,element:(0,k.jsx)(kn,{})})]})}),(0,k.jsx)(Le,{})]})}var Fe=function(){return(0,k.jsxs)(Ye,{between:!0,children:[(0,k.jsxs)(Qe,{gap:!0,children:[(0,k.jsx)(l.zL,{type:"link",onClick:x.Xj,children:(0,k.jsx)(f.r,{width:"13rem",height:"3rem",color:"rgb(38, 132, 255)"})}),(0,k.jsx)(q,{}),(0,k.jsx)(b,{})]}),(0,k.jsx)(Re,{children:(0,k.jsx)(Ae,{})})]})},Ae=function(){var n=(0,y.a)(),e=n.user,r=n.logout;return(0,k.jsx)(u.Z,{overlay:(0,k.jsx)(s.Z,{children:(0,k.jsx)(s.Z.Item,{children:(0,k.jsx)(c.Z,{onClick:r,type:"link",children:"\u767b\u51fa"})},"logout")}),children:(0,k.jsxs)(c.Z,{type:"link",onClick:function(n){return n.preventDefault()},children:["Hi,",null===e||void 0===e?void 0:e.name]})})},ze=o.ZP.div(Ce||(Ce=(0,a.Z)(["\n  display: grid;\n  grid-template-rows: 6rem 1fr; // 6rem;\n  /* grid-template-columns: 20rem 1fr 20rem;\n  grid-template-areas:\n    'header header header'\n    'nav main aside'\n    'footer footer footer'; */\n  height: 100vh;\n  /* grid-gap: 10rem; */\n"]))),Ye=(0,o.ZP)(l.X2)(Pe||(Pe=(0,a.Z)(["\n  padding: 3.2rem;\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\n  z-index: 1;\n"]))),Qe=(0,o.ZP)(l.X2)(we||(we=(0,a.Z)(["\n  /* display: flex;\n  align-items: center; */\n"]))),Re=o.ZP.div(Te||(Te=(0,a.Z)([""]))),We=o.ZP.main(Oe||(Oe=(0,a.Z)(["\n  /* display: flex; */\n  overflow: hidden;\n  /* grid-area: main; */\n  /* height: calc(100vh - 6rem); */\n"])))}}]);
//# sourceMappingURL=293.e6ceaf88.chunk.js.map